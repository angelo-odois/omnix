Construir um SaaS whitelabel de atendimento por WhatsApp com integra√ß√£o Salvy (aquisi√ß√£o/gest√£o de n√∫meros digitais) e integra√ß√£o WAHA (mensageria, baseado em WhatsApp Web), com m√∫ltiplos operadores no mesmo n√∫mero, m√∫ltiplos n√∫meros por tenant (sele√ß√£o em tempo real por operador) e um m√≥dulo de Workflows estilo n8n (drag-and-drop) que consome os endpoints do WAHA para automa√ß√µes de triagem/boas-vindas, dando sensa√ß√£o de IA. A UI n√£o deve copiar o WhatsApp Web; queremos layout pr√≥prio, limpo e eficiente.
Haver√° um Console da Dois (Master Admin) para governan√ßa de tenants, e um Painel do Tenant (Admin/Gestor/Operador). Todos os dados persistidos devem ser criptografados (detalhes em Seguran√ßa).
Fontes t√©cnicas do WAHA (para o time):
Swagger/OpenAPI do WAHA (listar/inspecionar endpoints, exemplos, testes via Swagger UI). 
WAHA
Guia de Swagger do WAHA (como usar a especifica√ß√£o/Swagger UI). 
WAHA
Configura√ß√£o WAHA & envs relevantes (ex.: WAHA_BASE_URL, portas). 
WAHA
Hardening do WAHA (uso de WAHA_API_KEY para proteger endpoints). 
Medium
Ambientes & Perfis
Console da Dois (Master Admin)
Criar/editar/suspender tenants; planos/limites/flags; billing; observabilidade global; cat√°logo de n√∫meros (Salvy) e fleet manager das inst√¢ncias WAHA; impersonate para suporte; auditoria e LGPD.
Painel do Tenant (Cliente)
Perfis: Admin, Gestor, Operador. Login via magic link/OTP. Whitelabel (logo/cores/dom√≠nio). RBAC por fila/inst√¢ncia.
Integra√ß√µes
Salvy (n√∫meros digitais)
Cat√°logo/compra/portabilidade de DIDs; v√≠nculo ao tenant; provisionamento autom√°tico de inst√¢ncia WAHA correspondente; painel de custos/uso; auditoria.
WAHA (inst√¢ncias/sess√µes)
V√°rias inst√¢ncias por tenant (1 inst√¢ncia = 1 n√∫mero). Sa√∫de da sess√£o (Conectado/QR/Erro), m√©tricas e webhooks (message, ack/status) conforme a OpenAPI/Swagger. 
WAHA
+1
Atendimento & CRM
Sele√ß√£o de N√∫mero (inst√¢ncia WAHA)
Seletor fixo na conversa; default por operador; troca por conversa.
Aceite: pr√≥xima mensagem sai pelo novo instance_id; metadados gravados.
Apresenta√ß√£o do Atendente
Na 1¬™ resposta ou mudan√ßa de assignee, prefixar:
üë§ Atendente: {{operator_name}} ‚Äî {{team}}
Aceite: vis√≠vel ao cliente e persistido.
Distribui√ß√£o/Colabora√ß√£o
Round-robin/menos ocupado/por fila; presen√ßa ‚Äúdigitando/visualizando‚Äù; bloqueio suave; transfer√™ncia; notas internas; tags; SLA/auto-resposta fora do hor√°rio.
Mensagens
Texto, m√≠dia (imagem/√°udio/v√≠deo/doc via URL/upload), templates aprovados, respostas r√°pidas; status enviado/entregue/lido; marcar como lida.
Lista de Contatos (CRM leve)
Auto-enriquecimento ao primeiro contato: telefone E.164, nome, tags, empresa, observa√ß√µes, campos custom; busca instant√¢nea; hist√≥rico completo.
Workflows estilo n8n (sensa√ß√£o de IA)
Canvas drag-and-drop com:
Triggers: mensagem recebida, hor√°rio, webhook, mudan√ßa de assignee/status.
A√ß√µes WAHA: enviar texto/m√≠dia/template, marcar lida, transferir fila/operador, encerrar. (Basear em endpoints do Swagger WAHA). 
WAHA
Condi√ß√µes: keyword/regex, hor√°rio, canal, tags, vari√°veis, inten√ß√£o simples (sin√¥nimos/regras).
Delays/Retry, HTTP Request, vari√°veis/contexto.
‚ÄúIA-like‚Äù: sugest√£o de respostas por biblioteca + placeholders; classifica√ß√£o por regras; conector LLM opcional (feature flag).
Versionamento, Draft‚ÜíActive, simula√ß√£o com logs por n√≥; blueprints p√∫blicos (Dois) e privados (tenant).
Escopo: global, por fila, por inst√¢ncia ou por tag de contato.
Landing Page de Venda (whitelabel por tenant opcional)
Objetivo: converter leads B2B para trial/contato comercial.
P√°ginas/Se√ß√µes (MVP):
Hero (headline claro + subheadline + CTA ‚ÄúTestar gr√°tis‚Äù/‚ÄúFalar com time‚Äù).
Prova social (logos, depoimentos curtos, m√©tricas).
Como funciona (3‚Äì5 cards: Multioperador; Multin√∫mero; Workflows ‚ÄúIA-like‚Äù; Integra√ß√£o WAHA; N√∫meros Salvy).
Demonstra√ß√£o (GIF/loom curto + 3 highlights do fluxo real).
Casos de uso (Comercial, Suporte, Cobran√ßa/Backoffice).
Planos & pre√ßos (por inst√¢ncia/operador/mensagens; comparar recursos; FAQs de billing).
Seguran√ßa & Conformidade (ver se√ß√£o Seguran√ßa abaixo‚Äîresumo amig√°vel + link para p√°gina t√©cnica).
Integra√ß√µes (WAHA + Salvy; men√ß√£o ao Swagger/OpenAPI do WAHA). 
WAHA
+1
FAQ (limites, templates de mensagem, privacidade/LGPD, suporte).
CTA final (Trial / Demo).
Requisitos de LP:
Performance: LCP < 2.0s (p75), imagens otimizadas/lazy, fontes locais.
SEO: t√≠tulos H1/H2, schema Product/FAQ, OpenGraph/Twitter, sitemap/robots.
A/B testing (hero/CTA), Pixels (GA4, Meta, LinkedIn) + consent (LGPD).
Formul√°rio com valida√ß√£o e rate-limit; integra√ß√£o com CRM/n8n.
Painel de edi√ß√£o (CMS leve) para textos/pre√ßos/FAQs (por tenant, se whitelabel).
Requisitos N√£o Funcionais
Idempot√™ncia: dedupe por waha_message_id/message.id (reprocessos n√£o duplicam).
Lat√™ncia alvo: recebimento ‚Üí UI < 1s (p95).
Escalabilidade/Resili√™ncia: filas, retries exponenciais, circuit breaker, backpressure.
Observabilidade: logs estruturados, m√©tricas, tracing; alertas.
Privacidade/LGPD: segrega√ß√£o por tenant, reten√ß√£o configur√°vel, export/delete sob solicita√ß√£o.
Seguran√ßa & Criptografia (obrigat√≥rio)
Em tr√¢nsito:
TLS 1.3 em todos os dom√≠nios; HSTS; CORS restrito; CSP estrito; cookies Secure/HttpOnly quando aplic√°vel.
Em repouso (persist√™ncia):
Criptografia por padr√£o de TODOS os dados:
Banco: envelope encryption com chave por tenant (KEK no KMS + DEK por tabela/registro). Campos sens√≠veis (PII/telefones/nome, notas internas, metadados de mensagens) com criptografia de campo (AEAD: AES-GCM/ChaCha20-Poly1305).
Arquivos/m√≠dia: Storage com server-side encryption + link assinado (expira em minutos); opcional client-side encryption no upload.
Backups: criptografados com chaves separadas e rota√ß√£o.
Gest√£o de chaves: KMS (GCP/AWS) com rota√ß√£o autom√°tica, envelopamento, KDF, logs de acesso, split-knowledge para opera√ß√µes.
Segredos: Vault/Secret Manager; nunca em c√≥digo.
Webhooks WAHA: HMAC obrigat√≥rio (timestamp/nonce, janela de aceita√ß√£o), verificar e deduplicar; WAHA_API_KEY habilitado na inst√¢ncia WAHA. 
Medium
Acesso & Auditoria:
JWT com scopes; impersonation auditado; MFA para perfis sens√≠veis (Console da Dois).
Rate-limit por IP/tenant; detec√ß√£o de abuso (envio massivo/m√≠dia).
Trilhas de auditoria imut√°veis (WORM) para a√ß√µes administrativas.
Fluxos-Chave (com crit√©rios de aceite)
Escolha de N√∫mero: seletor mostra inst√¢ncias (‚ÄúComercial (55 11)‚Äù, ‚ÄúSuporte (55 61)‚Äù).
Aceite: pr√≥xima mensagem usa o novo instance_id; metadados registrados.
Apresenta√ß√£o do Atendente: prefixo na 1¬™ resposta ou mudan√ßa de assignee.
Aceite: vis√≠vel ao cliente e persistido no hist√≥rico.
Atendimento Simult√¢neo no Mesmo N√∫mero: m√∫ltiplos operadores na mesma inst√¢ncia.
Aceite: roteamento evita colis√£o; presen√ßa/‚Äúdigitando‚Äù vis√≠vel; bloqueio suave ativo.
Lista de Contatos: contato criado/atualizado; edi√ß√£o de nome/tags.
Aceite: busca instant√¢nea; hist√≥rico completo ao abrir.
Webhook WAHA: receber message e ack/status; validar HMAC; dedupe.
Aceite: reprocessar o mesmo message.id 3x gera 1 registro √∫nico; status atualiza sem duplicar. 
WAHA
Integra√ß√£o Salvy: comprar DID ‚Üí vincular ‚Üí provisionar inst√¢ncia WAHA.
Aceite: n√∫mero dispon√≠vel no seletor; health-check OK exibido.
Workflow de Boas-Vindas (IA-like): mensagem sem assignee dispara triagem (inten√ß√£o por regras/sin√¥nimos, resposta, transfer, delay, fallback humano).
Aceite: logs por n√≥; resposta correta < 2s; takeover com 1 clique.
Landing Page:
Aceite: LCP p75 < 2.0s; SEO b√°sico ok; formul√°rio proteg. anti-spam; eventos GA4 disparando; varia√ß√£o A/B cadastrada; se√ß√£o de Seguran√ßa espelhando os controles acima.
Dados & Modelagem (alto n√≠vel)
tenants(id, nome, dom√≠nio, tema, plano, flags, billing_config, status, created_at, kms_key_id)
users(id, tenant_id, nome, email, perfil, ativo, defaults)
instances(id, tenant_id, salvy_number_id, waha_instance_id, apelido, status, m√©tricas)
contacts(id, tenant_id, phone_e164 uniq_enc, nome_enc, tags_enc[], empresa_enc, campos_custom_enc)
conversations(id, tenant_id, contact_id, instance_id, assignee_user_id, fila, status, sla, notas_enc)
messages(id, tenant_id, conversation_id, direction, instance_id, waha_message_id uniq, type, body_enc/meta_enc, status, ts)
workflows(id, tenant_id, nome, escopo, vers√£o, estado, json_definition_enc, logs)
audit_logs(tenant_id, actor, a√ß√£o, alvo, payload_enc, ts, immutable)
numbers_salvy(id, tenant_id, did, status, custo, data_aquisicao)
plans/feature_flags/billing_events/invoices/usages por tenant/inst√¢ncia.
Sufixos _enc indicam criptografia de campo (AEAD).
Endpoints (alto n√≠vel)
Ingressos
POST /webhooks/waha ‚Äî headers X-Signature-HMAC, X-Timestamp; valida HMAC; dedupe por message.id; enfileira realtime. (Basear na Swagger). 
WAHA
POST /webhooks/billing ‚Äî eventos de cobran√ßa.
API Tenant
GET /instances | POST /messages/send | POST /conversations/transfer | GET /contacts?query=
POST /workflows/run-test | POST /salvy/numbers/purchase | POST /salvy/numbers/link
API Console da Dois
POST /admin/tenants | POST /admin/tenants/:id/impersonate
POST /admin/plans | POST /admin/feature-flags
GET /admin/observability/* | POST /admin/blueprints/publish
UX & UI (diretrizes)
Console da Dois: vis√£o por tenant (sa√∫de/uso/custo/alertas), a√ß√µes r√°pidas (reset QR, reprovisionar WAHA), cat√°logo de n√∫meros Salvy, publica√ß√£o de blueprints.
Tenant: seletor de inst√¢ncia fixo; p√≠lulas de presen√ßa; status da inst√¢ncia; Canvas de Workflow com minimapa/zoom/valida√ß√£o; a√ß√µes r√°pidas (marcar lida/transferir/template/nota).
Landing Page: visual clean, se√ß√£o ‚ÄúComo funciona‚Äù animada, badge de seguran√ßa (KMS, HMAC, AES-GCM), captura de lead com prova social.

Mapei cada arquivo criado dentro da arvore do projeto, para que eu saiba onde devo criar cada aqui.
